<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="http://docbook.org/xml/5.1/rng/docbookxi.rng" schematypens="http://relaxng.org/ns/structure/1.0"?>
<?xml-model href="http://docbook.org/xml/5.1/sch/docbook.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1">
    <title>Differences between ANF and CIF </title>
    <informaltable>
        <tgroup cols="1">
            <colspec colnum="1" colname="col1"/>
            <tbody>
                <row>
                    <entry>
                        <para><emphasis role="bold">Purpose of this section:</emphasis></para>
                        <itemizedlist>
                            <listitem>
                                <para>Explain how the ANF Model is different from CIF </para>
                            </listitem>
                            <listitem>
                                <para>Explain the consequences of the differences for data
                                    retrieval</para>
                            </listitem>
                        </itemizedlist>
                    </entry>
                </row>
            </tbody>
        </tgroup>
    </informaltable>
    <para>There are two fundamental differences between the ANF and CIF approach. The first is the
        representation of topic, and the second is the representation of results.</para>
    <orderedlist>
        <listitem>
            <para>The representation of topic.</para>
        </listitem>
        <listitem>
            <para>The representation of results.</para>
        </listitem>
    </orderedlist>
    <section>
        <title>The Representation of Topic</title>
        <para>In the ANF model, the topic is represented by a single field containing a simple to
            complex post-coordinated SNOMED expression, whereas in the CIF model, all the pieces of
            information that make up the topic can be broken out and structured as needed into
            a complex tree of objects with multiple properties and appropriate datatypes.</para>
        <para>
            <figure>
                <title>Topic Comparison for a Complex Topic</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/cif_anf_topic.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
        </para>
        <para> As we can see in the Pulse Rate examples below, the ANF topic is represented 
            as a post-coordinated expression while the CIMI Representation is represented with a
            single concept in the topic and associated properties representing the pulse oximeter device.<figure>
                <title>Pulse Rate - ANF Representation</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/pulse_rate_anf.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <figure>
                <title>Pulse Rate - CIMI Representation</title>
                <mediaobject>
                    <imageobject>
                        <?oxy_comment_start author="timowilliams" timestamp="20190508T115045-0500" comment="Could this one be represented without the device as a separate entity and contained in the topicCode?  Could be another example of multiple representations."?>
                        <?oxy_comment_start author="timowilliams" timestamp="20190520T161717-0500" comment=" JCoyle - I&apos;m not sure what you are saying here.  What do you mean by a separate entity?  Are you saying to redo this same instance leaving out the device information? " mid="1"?>
                        <imagedata fileref="images/pulse_rate_cimi.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/><?oxy_comment_end?><?oxy_comment_end mid="1"?>
                    </imageobject>
                </mediaobject>
            </figure>
        </para>  
        <para>One implication of this is that the ANF is using two formalisms to represent the
            detailed clinical model. First it uses the formalism that represents the ANF reference
            model and constraints such as HL7's StructureDefinition syntax or OpenEHR's BMM/ADL
            syntax. Second, it uses SNOMED's syntax for post-coordinated SNOMED expressions. Tools
            for authoring and analysis would be required to parse and process both syntaxes.</para>
        <para>The CIF model, on the other hand, would be fully represented using the formalism that
            represents the CIF reference model and constraints such as HL7's StructureDefinition
            syntax or OpenEHR's BMM/ADL syntax.
            <?oxy_comment_start author="timowilliams" timestamp="20190507T180110-0500" comment="I believe we can use one of the examples below to highlight this by representing the bodysite with and without the laterality.
"?>This
            model however allows for the possibility of multiple modeling style representations of the same data that are then not easily
            queried for equivalence. <?oxy_comment_end?></para>
    </section>
    <section>
        <title>The Representation of Results</title>
        <para>In the CIMI model, EvaluationResult and Assertion models are used to represent
            observations. EvaluationResult has a topic representing what is being observed, and a result represented by a choice of datatypes. An Assertion on the other hand, has simply a topic with a value of 'assertion', and a coded result stated what is being asserted.</para>
        <para>In the ANF model, the topic represents what is being observed and the result may only
            be a range of either a count or quantity. No coded results are allowed. Not allowing
            coded results forces more of the semantics to be representing in the terminology model
            and constrains the ability to allow multiple different representations of the same data.
            In the example below we see Dot blot hemorrhage represented in ANF as either present or
            with the number of hemorrhages that exist.</para>
        <figure>
            <title>Dot Blot Hemorrhage Present - ANF</title>
            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/dbh_anf.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </figure>
        <figure>
            <title>Three Dot Blot Hemorrhage - ANF</title>
            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/Three_dbh_anf.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </figure>
        <para>In the CIF model, when creating a model with a numeric result, the choice is quite
            clear, and the choice will be an EvaluationResult, such as a topic of 'Systolic Blood
            Pressure' and result with a numeric quantity. In this case, the CIF and ANF model are
            very aligned, except for the fact that the ANF model will always use a range of that
            quantity.</para>
        <figure>
            <title>Simple Systolic Blood Pressure - CIMI Representation</title>
            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/blood_pressure_cimi.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                </imageobject>
            </mediaobject>
        </figure>
        <para>But when a CIF model has a potential coded result, the choice between EvaluationResult
            and Assertion becomes muddied. For example, a model for Breath Sound could be an
            EvaluationResult with a topic of 'breath sound' and a coded result with the following
            valueset. Thus, any of the breath sounds within the valueset can act as a result for
            this model. </para>
        <para>
            <table>
                <title>Breath Sound Valueset</title>
                <tgroup cols="1">
                    <thead>
                        <row>
                            <entry>Breath Sound Value</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>Absent</entry>
                        </row>
                        <row>
                            <entry>Audible</entry>
                        </row>
                        <row>
                            <entry>Clear</entry>
                        </row>
                        <row>
                            <entry>Coarse Breath Sounds</entry>
                        </row>
                        <row>
                            <entry>Coarse Crackles</entry>
                        </row>
                        <row>
                            <entry>Crackles</entry>
                        </row>
                        <row>
                            <entry>Diminished</entry>
                        </row>
                        <row>
                            <entry>Expiratory wheezing</entry>
                        </row>
                        <row>
                            <entry>Faint</entry>
                        </row>
                        <row>
                            <entry>Fine Crackles</entry>
                        </row>
                        <row>
                            <entry>Forced</entry>
                        </row>
                        <row>
                            <entry>Inspiratory wheezing</entry>
                        </row>
                        <row>
                            <entry>Left Ventricular Assist Device Noise</entry>
                        </row>
                        <row>
                            <entry>Markedly Decreased</entry>
                        </row>
                        <row>
                            <entry>Moderately Decreased</entry>
                        </row>
                        <row>
                            <entry>Pleural Rub</entry>
                        </row>
                        <row>
                            <entry>Prolonged Expiration</entry>
                        </row>
                        <row>
                            <entry>Rhonchi</entry>
                        </row>
                        <row>
                            <entry>Slightly Decreased</entry>
                        </row>
                        <row>
                            <entry>Stridor</entry>
                        </row>
                        <row>
                            <entry>Tubular Breath Sounds</entry>
                        </row>
                        <row>
                            <entry>Upper Airway Congestion</entry>
                        </row>
                        <row>
                            <entry>Wheeze</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>
        <figure>
            <title>Breath Sound - CIMI Evaluation Representation</title>
            <mediaobject>
                <imageobject>
                    <?oxy_comment_start author="timowilliams" timestamp="20190510T115942-0500" comment="I think this one may be off."?>
                    <?oxy_comment_start author="timowilliams" timestamp="20190520T161744-0500" comment=" JCoyle - Yes, the result doesn&apos;t go in the topic, it goes in context.  

                    context(PresenceContext).contextCode = &quot;Some breath sound code&quot;

                    -

                    Also, I would either choose a result from the valueset, or add your result to the valueset 

                    " mid="4"?>
                    <imagedata fileref="images/breath_evalutation_cimi.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/><?oxy_comment_end?><?oxy_comment_end mid="4"?>
                </imageobject>
            </mediaobject>
        </figure>
        <para>The other option, is that each of the breath sounds in the valueset is modeled as an
            Assertion with a topic of 'assertion', and a result of each particular code. To decided
            which model is better, usually we ponder how the clinician thinks about the data, or how
            it will be collected, or how it will be queried.</para>
        <figure>
            <title>Breath Sound - CIMI Assertion Representation</title>
            <mediaobject>
                <imageobject>
                    <?oxy_comment_start author="timowilliams" timestamp="20190510T120637-0500" comment="Make sure this is correct CIMI
"?>
                    <?oxy_comment_start author="timowilliams" timestamp="20190520T161759-0500" comment=" JCoyle - Same problem with topic as above" mid="6"?>
                    <imagedata fileref="images/breath_assertion_cimi.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/><?oxy_comment_end?><?oxy_comment_end mid="6"?>
                </imageobject>
            </mediaobject>
        </figure>
        <para>The ANF model cannot do an EvaluationResult style model as it doesn't allow coded
            results. Thus, ANF is forced to make one and only one choice, which is an assertion
            style where the particular breath sound is the topic, and the result will be numeric
            count indicating presence or absence.</para>
        <para>When querying instance data, the Assertion or ANF style can be more difficult to
            represent as it requires concepts to be pre-coordinated in the terminology or having
            sufficient semantics available in the concept model to allow for representation of a
            post-coordinated expression. To successfully query any breath sound instances using the
            Assertion/ANF style, the underlying terminology must be correctly modeled to support. If
            one of the breath sound values is not correctly placed under the higher level concept of
            366135003 |Finding of breath sounds (finding)|, then retrieving all breath sounds will
            require knowledge of all the possible breath sound values.  With the EvaluationResult
            style, querying is simpler as you simply query for a topic of 'breath sound', and the
            coded result tells you what type of breath sound it is. Thus, you do not have to know all
            the members of the valueset apriori to form the query.</para>
    </section>
    <section>
        <title>ANF vs CIMI Examples</title>
        <para>The following examples seek to highlight the differences between the ANF and CIMI
            models.  These representations are at a graphic high level and are not intended to be
            exact representations.</para>
        <section>
            <title>Simple Systolic Blood Pressure Statement</title>
            <para>In this systolic blood pressure example both the ANF and CIMI models are closely
                aligned.  Since the ANF model requires both an upper and lower bound there is extra
                information required.</para>
            <figure>
                <title>Simple Systolic Blood Pressure - ANF Representation</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/blood_pressure_anf.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <figure>
                <title>Simple Systolic Blood Pressure - CIMI Representation</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/blood_pressure_cimi.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
        </section>
        <section>
            <title>Complex Systolic Blood Pressure Statement</title>
            <para>In this systolic blood pressure example the ANF model requires multiple statements
                to accurately capture all parts of the narrative clinical statement. The ANF model
                requires a clinical statement to be separated if  the clinical statement could stand
                on its own.  For example, in the clinical statement "Systolic Blood Pressure 120
                mmHg, taken on right brachial artery, using BP cuff adult size, patient in sitting
                position for at least 5 minutes, urinated not more than 30 minutes prior to
                measurement" The patient sitting position and urination parts of the statement are
                recorded as separate associated clincal statements since they could both be recorded as
                clincial statements on their own if they were not associated with the blood pressure
                clinical statement.</para>
            <para>The ANF model is much more expressive and is able to capture the timing
                information for the position and urination that requires a separate precondition code to be created in the CIMI model.</para>

            <figure>
                <title>Complex Systolic Blood Pressure - ANF Representation</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/bp_complex_anf.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <figure>
                <title>Complex Systolic Blood Pressure - Associated ANF Statement #1</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/bp_complex2_anf.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <figure>
                <title>Complex Systolic Blood Pressure - Associated ANF Statement #2</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/bp_complex3_anf.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <figure>
                <title>Complex Systolic Blood Pressure - CIMI Representation</title>
                <mediaobject>
                    <imageobject>
                        <?oxy_comment_start author="timowilliams" timestamp="20190508T115144-0500" comment="Can this one have the device merged into the topicCode?  Can the Laterality be merged into the code by just using the right brachial artery concept? Or via a post-coordinated expression?  I think this could be an example of the same CIMI example being represented in multipe ways that would require multiple different queries to determine equivalence."?>
                        <imagedata fileref="images/bp_complex_cimi.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/><?oxy_comment_end?>
                    </imageobject>
                </mediaobject>
            </figure>
        </section>
         
        <section>
            <title>Diabetes Mellitus Statement</title>
            <para>The Diabetes Mellitus example highlights the main difference between ANF and CIF
                in the case of stating that a condition is present.  In the case of ANF, since
                Result is not allowed to use a coded value it represents the presence as a
                lowerBound of 1 and an upperBound of infinite.  Representing absence would be done
                with an upper and lower bound of zero.</para>
            <figure>
                <title>Diabetes Mellitus - ANF Representation</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/dm_anf.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
            <figure>
                <title>Diabetes Mellitus - CIMI Representation</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="images/dm_cimi.svg" format="SVG" scalefit="1" width="100%" contentdepth="100%"/>
                    </imageobject>
                </mediaobject>
            </figure>
        </section>
    </section>
</chapter>
